# 住戶資料管理系統 (Resident Data Management System)

這是一個專為社區設計的住戶資料管理系統，採用 **前後端分離 (Headless Architecture)** 架構。前端介面託管於 GitHub Pages，後端邏輯與資料庫則由 Google Apps Script (GAS) 與 Google Sheets 驅動。

## 🚀 系統特色

### 🏠 住戶端 (Frontend)
- **資料填寫與更新**：住戶可輸入「戶號」登入，系統自動判斷是新增資料或更新現有資料。
- **車位管理**：支援汽車位 (包含車牌、出租資訊) 與機車位的登記。
- **驗證碼保護**：需輸入社區代碼才能提交資料，防止非法存取。
- **表單開關控制**：管理員可遠端開啟/關閉住戶填寫功能。
- **響應式設計**：支援手機與電腦瀏覽，介面簡潔直覺。

### 🛡️ 管理端 (Admin Dashboard)
- **安全登入**：
    - 管理員需輸入帳號密碼才能存取後台
    - 登入失敗自動清除密碼欄位
    - 連續登入失敗會鎖定帳號 (預設 5 次，鎖定 15 分鐘)
- **權限分級 (RBAC)**：
    - **讀寫權限 (RW)**：
        - 擁有完整功能，包含修改/刪除住戶資料
        - 可新增/管理管理員帳號、重設密碼、解鎖帳號
        - 可控制住戶填寫開關
        - 特殊紫色徽章標識 (⭐)
    - **唯讀權限 (RO)**：
        - 僅能查詢與瀏覽住戶資料
        - 無法進行任何修改或刪除操作
        - 無法進入管理員設定
        - 灰色徽章標識 (👤)
- **自動登出安全機制**：
    - **RW 管理員**：閒置 15 分鐘自動登出 (可調整)
    - **RO 管理員**：閒置 1440 分鐘 (24 小時) 自動登出 (可調整)
    - 剩餘時間少於 5 分鐘時顯示紅色倒數計時器
    - 任何互動 (點擊、鍵盤、滾動) 會重置計時器
- **資料檢索**：
    - **快速篩選**：依棟別 (110/112/116/118/120/122/126) 快速篩選
    - **搜尋功能**：支援搜尋戶號、姓名、電話、車牌號碼等多欄位
    - **排序功能**：可針對戶號、汽車位、機車位進行排序
    - **分頁顯示**：每頁 100 筆資料，提升載入效能
- **資料顯示優化**：
    - 聯絡資訊/屋主資訊單行顯示格式
    - 自動判定「屋主」或「非屋主」身份並以不同顏色標示
    - 載入中狀態會隱藏表格內容，避免資料閃爍
- **管理員功能**：
    - 新增/刪除管理員帳號
    - 重設管理員密碼
    - 編輯管理員備註
    - 解鎖被鎖定的帳號
    - 修改自己的密碼

## 🛠️ 技術架構

- **前端 (Frontend)**：
    - Vue.js 3 (Composition API)
    - Vanilla CSS (RWD Design)
    - GitHub Pages (Hosting)
- **後端 (Backend)**：
    - Google Apps Script (API Service)
    - Google Sheets (Database)
- **安全機制**：
    - Session Token 驗證
    - 密碼 SHA-256 加密
    - 登入失敗次數限制與帳號鎖定
    - 閒置自動登出
    - Honeypot 反機器人機制

## 📂 專案結構

```
resident-system-gas/
├── .github/workflows/   # GitHub Actions 自動部署設定
├── css/                 # 樣式表 (style.css)
├── js/                  # 前端邏輯 (main.js)
├── index.html           # 主頁面
├── Code.gs              # Google Apps Script 後端程式碼
└── README.md            # 專案說明文件
```

## ⚙️ 安裝與部署

### 1. 後端部署 (Google Apps Script)
1. 開啟 Google Sheets，建立新試算表
2. 點擊「擴充功能」→「Apps Script」
3. 將 `Code.gs` 的內容複製到編輯器中
4. 首次執行需手動執行 `initialSetup` 函式以建立資料表：
   - 點擊函式下拉選單，選擇 `initialSetup`
   - 點擊「執行」按鈕
   - 授權應用程式存取 Google Sheets
5. 點擊「部署」→「新增部署」→ 類型選擇「網頁應用程式」
6. 設定：
    - **執行身分**：我 (Me)
    - **誰可以存取**：任何人 (Anyone)
7. 複製取得的 **Web App URL**

### 2. 前端設定
1. 開啟 `js/main.js`
2. 將第 2 行的 `const API_URL` 的值替換為步驟 1 取得的 Web App URL：
   ```javascript
   const API_URL = 'YOUR_GAS_WEB_APP_URL_HERE';
   ```

### 3. 前端部署 (GitHub Pages)
1. 將專案推送到 GitHub Repository (`main` 分支)
2. 本專案已設定 GitHub Actions (`.github/workflows/deploy.yml`)，推送後會自動部署至 GitHub Pages
3. 前往 GitHub Settings → Pages 查看您的網站網址

## 📝 使用說明

### 預設設定
- **預設管理員帳號**：
    - 帳號：`admin`
    - 密碼：`admin123`
    - 權限：`RW` (讀寫)
- **預設社區代碼**：`12345678`
- **建議**：首次登入後立即建立新的管理員帳號，並修改預設密碼與社區代碼

### Google Sheets 設定表格 (Settings)
系統會自動建立 `Settings` 表格，可調整以下參數：

| 設定項目 | 預設值 | 說明 |
|---------|--------|------|
| `CommunityPasscode` | `12345678` | 住戶填寫資料驗證碼 |
| `AppTitle` | `住戶資料管理` | 系統標題 |
| `IsFormOpen` | `true` | 是否開放住戶填寫 (true/false) |
| `MaxLoginAttempts` | `5` | 最大登入錯誤次數 |
| `LockoutDurationMinutes` | `15` | 帳號鎖定時間 (分鐘) |
| `SessionTimeoutRW` | `15` | RW 管理員閒置登出時間 (分鐘) |
| `SessionTimeoutRO` | `1440` | RO 管理員閒置登出時間 (分鐘) |

### 資料表格結構
- **Residents**：住戶資料
- **Admins**：管理員帳號
- **Settings**：系統設定

## 🔒 安全性功能

1. **密碼加密**：所有密碼使用 SHA-256 加密儲存
2. **Session Token**：登入後產生唯一 Token，有效期限可設定
3. **登入保護**：
   - 連續登入失敗會鎖定帳號
   - 鎖定時間可在 Settings 調整
   - RW 管理員可手動解鎖帳號
4. **自動登出**：
   - 閒置超時自動登出
   - 超時前 5 分鐘顯示倒數提醒
   - 超時時間可依權限分別設定
5. **權限控制**：
   - RW/RO 權限分級
   - API 層級權限驗證
   - 前端 UI 依權限顯示/隱藏功能

## 📊 功能清單

### 住戶端
- [x] 戶號登入
- [x] 緊急聯絡人資料填寫
- [x] 租客/屋主身份選擇
- [x] 屋主資料填寫 (租客模式)
- [x] 汽車位資訊 (車位號碼、車牌、出租資訊)
- [x] 機車位資訊
- [x] 社區代碼驗證
- [x] 表單開關控制 (管理員遠端控制)

### 管理端
- [x] 安全登入 (帳號密碼)
- [x] 權限分級 (RW/RO)
- [x] 住戶資料查詢
- [x] 快速篩選 (依棟別)
- [x] 搜尋功能 (戶號/姓名/電話/車牌)
- [x] 排序功能 (戶號/車位)
- [x] 分頁顯示
- [x] 刪除住戶資料 (RW 限定)
- [x] 管理員帳號管理 (RW 限定)
- [x] 密碼修改
- [x] 帳號鎖定/解鎖
- [x] 自動登出機制
- [x] 閒置倒數提醒
- [x] 表單開關控制 (RW 限定)

## 🎯 未來規劃

- [ ] 資料匯出功能 (Excel/CSV)
- [ ] 批次匯入功能
- [ ] 資料變更歷史記錄
- [ ] Email 通知功能
- [ ] 更細緻的權限控制

## 📄 授權

本專案採用 MIT 授權條款。

## 🤝 貢獻

歡迎提交 Issue 或 Pull Request 來改善本專案！
